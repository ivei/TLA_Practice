# ç¬¬6ç«  æ—¶é—´é€»è¾‘Temporal Logic

æ£€æŸ¥ç¨‹åºæœ¬èº«çš„è¡Œä¸ºï¼ˆåŸæ–‡ä¸­å«`behavior`ï¼‰ã€‚
1. ç®—æ³•æ˜¯å¦æ€»èƒ½ç»“æŸï¼ˆ**terminate**ï¼‰
2. é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ˜¯å¦éƒ½èƒ½å¾—åˆ°å¤„ç†
3. å½“å—åˆ°æ‰°ä¹±ï¼ˆ**disrupted**ï¼‰æ—¶ï¼Œç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿæœ€ç»ˆå›åˆ°ç¨³å®šçš„çŠ¶æ€
4. æ•°æ®åº“æ˜¯å¦æ»¡è¶³æœ€ç»ˆä¸€è‡´æ€§

## 6.1 ç»ˆæ­¢Termination
æ£€æŸ¥ç®—æ³•æ˜¯å¦æœ€ç»ˆèƒ½åœæ­¢ï¼Œè€Œä¸ä¼šcrashæˆ–é™·å…¥æ­»å¾ªç¯

### 6.1.1 çº¢ç»¿ç¯çš„ä¾‹å­

ä¸€è¾†è½¦å’Œä¸€ä¸ªçº¢ç»¿ç¯ï¼Œåˆ†åˆ«æ˜¯ä¸¤ä¸ªprocessï¼š`traffic light`åˆ‡æ¢ä¿¡å·ç¯ï¼Œ`car`åœ¨ç¯å˜ç»¿ä¹‹å‰ä¸€ç›´ç­‰å¾…


```
extColor(c) == CASE c = "red" -> "green"
                                [] c = â€greenâ€œ -> â€redâ€œ

(*--algorithm traffic 
variables   
    at_light = TRUE,   â“at_lightè¿™ä¸ªå˜é‡çš„ä½œç”¨ä¸ç†è§£
    light = â€redâ€œ; 
process light = â€lightâ€œ 
begin   
    Cycle:     
        while at_light do       
            light := NextColor(light);     
        end while; 
end process; 

process car = â€carâ€œ 
begin   
    Drive:     
       when light = â€greenâ€œ;     
       at_light := FALSE;    â“ä¸ºä»€ä¹ˆè¦è¿™é‡Œç½®ä¸ºå‡ï¼Ÿ
end process; 

end algorithm;*)
```

> â‰ï¸è¿™ä¸ªä¾‹å­ä¸­çš„`at_light`å¾ˆå¥‡æ€ªï¼Œå³ä½¿ä¸è€ƒè™‘å…¶ä»–çš„å› ç´ ï¼Œä¸€æ—¦`car`è¿›ç¨‹è·å¾—æ‰§è¡Œï¼Œå®ƒä¼šè¢«ç½®ä¸ºå‡ï¼Œç¯å°±å†ä¹Ÿæ²¡æœºä¼šåˆ‡æ¢äº†ã€‚

è¿™ä¸ªä¾‹å­æ‰§è¡Œåˆ°æœ€åï¼Œç»ˆç»“åœ¨ç›¸åŒçš„çŠ¶æ€ï¼šç»¿ç¯äº®ï¼Œtraceæ˜¾ç¤ºï¼‚stutteringï¼‚ã€‚

### 6.1.2 stuttering
é’ˆå¯¹ä¸€ç§ç‰¹åˆ«çš„åœºæ™¯ï¼šè¿›ç¨‹ä¸æ‰§è¡Œã€‚
stutteringä¸ä¸€å®šæ˜¯é”™çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯æ„å‘³ç€è¯¸å¦‚æœåŠ¡å™¨å´©æºƒï¼Œå¤„ç†è¶…æ—¶ï¼Œæˆ–ç­‰å¾…çš„ä¿¡å·ä»æœªåˆ°è¾¾ç­‰ï¼Œ
**liveness** checksï¼šéªŒè¯ç³»ç»Ÿæœ€ç»ˆåšäº†ä½ å¸Œæœ›å®ƒåšçš„äº‹æƒ…ã€‚

#### 6.1.2.1 å…¬å¹³Fairnessï¼Œå¼ºå…¬å¹³å’Œå¼±å…¬å¹³
**å¼±å…¬å¹³**ï¼šåªè¦æ¡ä»¶ä¸€ç›´æ»¡è¶³ï¼Œå®ƒæ€»ä¼šå‘ç”Ÿï¼šif it stays enabled, eventually happen
**å¼ºå…¬å¹³**ï¼šè‹¥æ¡ä»¶å‘¨æœŸæ€§è¢«æ»¡è¶³ï¼Œåˆ™æ€»ä¼šå‘ç”Ÿï¼šif itâ€™s repeatedly enabled, will eventually happen.

â—ï¸æˆ‘çš„ç†è§£æ˜¯ï¼Œä¸¤ä¸ªçš„ç»“æœéƒ½æ˜¯ï¼‚æœ€ç»ˆä¼šå‘ç”Ÿï¼‚ï¼Œä½†æ¡ä»¶ä¸ä¸€æ ·ã€‚å¼±å…¬å¹³çš„æ¡ä»¶æ›´è‹›åˆ»ä¸€äº›ï¼šè¦ä¸€ç›´æ»¡è¶³ï¼ˆä¿æŒè¿™ä¸ªçŠ¶æ€ï¼‰ï¼Œè€Œå¼ºå…¬å¹³çš„æ„æ€æ˜¯ï¼Œä½ ä¸éœ€è¦æ—¶åˆ»ä¿æŒè¿™ä¸ªä½¿èƒ½çŠ¶æ€ã€‚

ä¸‹é¢ä¾‹å­ä¸­åŠ äº†å¼±å…¬å¹³æ¡ä»¶ï¼š
```
fair process light = "light"   â—ï¸åŠ äº†fair
begin   Cycle:     
    while at_light do       
        light := NextColor(light);     
    end while; 
end process; 

fair process car = â€carâ€œ   â—ï¸
begin   
    Drive:     
        when light = â€greenâ€œ;     
        at_light := FALSE; 
end process;
```

ä¸¤ä¸ªè¿›ç¨‹éƒ½è¦è¢«è®¾ä¸ºfairï¼š
* è‹¥ä»…`car`ä¸ºfairï¼Œé‚£ä¹ˆç¯å¯èƒ½æ°¸è¿œä¸ä¼šåˆ‡æ¢
* è‹¥ä»…`light`ä¸ºfairï¼Œå³ä½¿ç¯å˜äº®äº†è½¦ä¹Ÿä¸ä¼šå¼€

â—ï¸ä½†è¿™ä¸ªè§„æ ¼ä»ç„¶ä¼šå¤±è´¥
> ä½œè€…çš„æ„æ€ä¼¼ä¹æ˜¯ï¼Œè‹¥è°ƒåº¦ç³»ç»Ÿæ°å¥½å§‹ç»ˆè®©ç¯åœ¨çº¢çš„æ—¶å€™è°ƒåº¦è½¦ï¼Œè½¦ç…§æ ·èµ°ä¸äº†
> ä¹¦ä¸­è¯´ï¼š`fairness`ä»…ä»…ä¿è¯å½“æ¡ä»¶**å§‹ç»ˆ**ä¿æŒæ—¶æ€»èƒ½å¾—åˆ°æœºä¼šï¼Œè€Œè¿™é‡Œçš„æ¡ä»¶å´æ˜¯å§‹ç»ˆåœ¨enableå’Œdisableä¹‹é—´å¾ªç¯ï¼Œè¿™å°±ä¸èƒ½ä¿è¯äº†
> æ˜¯ä¸æ˜¯è¿™ä¸ªæ„æ€ï¼Ÿ

> è¿™ä¸ªåœºæ™¯æˆ‘å€’æ˜¯ä»æœªæƒ³è¿‡è€ƒè™‘è¿‡ï¼

è¿™å°±éœ€è¦**å¼ºå…¬å¹³**è¦æ±‚ã€‚ç”¨`fair+`æ¥è¡¨ç¤º


```
fair+ process car = "car" 
begin   
    Drive:     
        when light = â€greenâ€œ;     
        at_light := FALSE; 
end process;
```
æ³¨æ„ï¼Œlightä»ç„¶éœ€è¦ä¸ºfair

## 6.2 Temporal Operators
### 6.2.1 []
è¡¨ç¤º**always**çš„æ„æ€ã€‚
`[]P`è¡¨ç¤ºPåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯True
åœ¨TLCä¸­ï¼ŒæŠŠPå£°æ˜ä¸ºä¸å˜é‡è®¡ç®—æ•ˆç‡æ›´é«˜

### 6.2.2 <>
è¡¨ç¤º**æœ€ç»ˆeventually**çš„æ„æ€ã€‚`<>P`è¡¨ç¤ºæ€»æœ‰ä¸€ä¸ªçŠ¶æ€Pä¸ºTrueï¼Œä¹‹å‰å®ƒå¯èƒ½ä¸ºFalseï¼Œä¹‹åä¹Ÿå¯èƒ½æ˜¯Falseã€‚
> è¿™é‡Œçš„`eventually`çš„æ›´å‡†ç¡®æ„æ€åº”è¯¥æ˜¯ï¼Œï¼‚**ç»ˆå½’ä¼š**ï¼‚çš„æ„æ€ã€‚å®ƒæŒ‡çš„æ˜¯å­˜åœ¨ä¸€ä¸ªçŠ¶æ€ï¼Œè€Œå¹¶ä¸æ˜¯è¯´è¿™æ˜¯æœ€ç»ˆçš„çŠ¶æ€ï¼

åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ˜¯è¿™æ ·å®šä¹‰åˆå§‹çŠ¶æ€çš„ï¼š
```
variables   
    at_light = TRUE,   
    light = â€redâ€œ;
```
ä»è€Œ`<>(light = â€œgreenâ€)`å°±æ˜¯ä¸€ä¸ªæ»¡è¶³çš„æ—¶é—´å±æ€§ã€‚

ä½†å¦‚æœæˆ‘ä»¬è¿™æ ·å†™ï¼š
```
variables   
    at_light = TRUE,   
    light = â€greenâ€œ;
```
é‚£ä¹ˆ`<>(light = "red") `å°±ä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ»¡è¶³çš„ã€‚TLCå¯ä»¥æ‰¾åˆ°ä¸€ç§æ‰§è¡Œæ–¹å¼è®©å®ƒä¸æˆç«‹ã€‚
> ğŸ”†ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€åˆçš„ä¾‹å­å†™çš„å¥‡æ€ªçš„åœ°æ–¹å°±æ˜¯å…¶å›çš„ï¼å®ƒå°±æ˜¯è¦è®©è½¦è¿åŠ¨ä¹‹åç¯å°±ä¸€ç›´æ˜¯ç»¿è‰²çš„ã€‚

`~<>P`æ„æ€æ˜¯Pæ°¸è¿œä¸ä¼šä¸ºçœŸï¼Œå®ƒå’Œ`[]~P`æ˜¯ç­‰ä»·çš„
`<>P`çš„æ­£å¼å®šä¹‰å°±æ˜¯`~[]~P`

å‰é¢çš„**termination**çš„æ­£å¼å®šä¹‰æ˜¯ï¼šæœ€ç»ˆæ‰€æœ‰è¿›ç¨‹éƒ½done(`eventually all processes are done`)ï¼š`Termination == <>(\A self \in ProcSet: pc[self] = â€Doneâ€œ)`

### 6.2.3~>
å®ƒçš„æ„æ€æ˜¯**leads-to**ã€‚
`P~>Q`è¡¨ç¤ºå¦‚æœæŸäº›çŠ¶æ€ä¸‹Pä¸ºTrueï¼Œåˆ™Qæˆ–è€…ç°åœ¨æˆ–è€…åœ¨æœªæ¥ä¼šå˜ä¸ºTrueã€‚å¹¶ä¸”ï¼Œè¿™ç§ç»“æœæ˜¯ä¸å¯æ›´æ”¹çš„ï¼šå³ä½¿ä»¥åPå˜æˆäº†Falseï¼ŒQä»ç„¶ä¸€å®šä¼šå‘ç”Ÿ

è‹¥æˆ‘ä»¬å†™
`L == (light = â€greenâ€œ) ~> ~at_light`
åˆ™ä¸‹é¢å‡ ç§æƒ…å†µä¸‹Lä¸ºTrueï¼š
* `light`ä»æœªå˜ç»¿ï¼Œæˆ–
* lightå˜æˆç»¿è‰²ï¼Œè€Œä¸”æŸä¸ªæ—¶åˆ»åcarè¿è¡Œå°†at_lightè®¾æˆFalse

ä¸`<>`ä¸ä¸€æ ·çš„æ˜¯ï¼Œæ¯æ¬¡På˜ä¸ºTrueæ—¶`~>`éƒ½ä¼šè¢«è§¦å‘

åœ¨åŸè§„æ ¼ä¸­ï¼Œ` (light = "red") ~> (light = "green")`ä¼šè¢«æ»¡è¶³ï¼Œè€Œè‹¥æˆ‘ä»¬è¿™æ ·å†™å°±ä¸ä¼šæ»¡è¶³äº†ï¼š

```
Cycle:     
    while at_light do       
        light := NextColor(light);     
   end while;     
   light := â€redâ€œ;
```

ç¯çš„çŠ¶æ€ä¼šæ˜¯ï¼šçº¢ï¼ã€‰ç»¿ï¼ã€‰çº¢ï¼Œå¹¶ä¸”ä¸ä¼šå†å˜ç»¿ï¼Œå› æ­¤è§„çº¦ä¸èƒ½è¢«æ»¡è¶³

`P ~> []Q`ï¼šè‹¥Pä¸ºTrueï¼Œåˆ™å­˜åœ¨æŸä¸ªçŠ¶æ€Qå˜ä¸ºTrueä¸”æ°¸è¿œä¸ºTrue

### 6.2.4 [ ]<> and <>[ ]
* `[]<>P`è¡¨ç¤ºP**æ€»æ˜¯æœ€ç»ˆ**ä¸ºTrueï¼ˆ**always eventually** trueï¼‰
* `<>[]P`è¡¨ç¤ºP**æœ€ç»ˆæ€»æ˜¯**ä¸ºTrueï¼ˆ**eventually always** trueï¼‰
åœ¨æœ‰é™çŠ¶æ€ï¼ˆfinite specï¼‰ä¸‹ï¼Œä¸¤è€…æ˜¯ç›¸åŒçš„ã€‚
åœ¨æ— é™çŠ¶æ€ï¼ˆinfinite specï¼‰ä¸‹ï¼š
* `<>[]P`è¡¨ç¤ºå­˜åœ¨æŸäº›Pointï¼ŒPå˜ä¸ºTrueä¸”æ°¸è¿œä¿æŒä¸ºTrue
* `[]<>P`è¡¨ç¤ºè‹¥Pæ›¾ç»å˜ä¸ºFalseï¼Œå®ƒæœ€ç»ˆä»ä¼šå˜æˆTrue

åœ¨å‰é¢çš„è§„æ ¼ä¸­ï¼Œ`[]<>(light = "green")`å’Œ`<>[](light = "green")`éƒ½æ˜¯Trueï¼Œè€Œ`[]<>(light = "red")`å’Œ`<>[](light = "red")`ä¸ºFalseã€‚

è‹¥æŠŠlightè§„æ ¼æ”¹ä¸ºä¸‹é¢ï¼š

```
while TRUE do       
    light := NextColor(light);     
end while;
```
åˆ™`<>[](light = "green")`ä¸ºFalseè€Œ`[]<>(light = "red")`ä¸ºTrue

TLCä¹Ÿä¸æ”¯æŒ`<>[]`å’Œ`[]<>`å¯¹`\in`

## 6.3 é™åˆ¶

å®é™…ä¸Šæ—¶é—´å±æ€§ç”¨å¾—å¾ˆå°‘
è®¡ç®—å¾ˆæ…¢ï¼Œ**ååˆ†æ…¢**
**do not combine temporal properties and symmetry sets. Regular sets of model constants are fine, but not symmetry sets. TLC optimizes symme**


## 6.4 Example

Dekkerâ€™s Algorithmï¼šå…è®¸ä¸¤ä¸ªçº¿ç¨‹å…±äº¨ä¸€ä¸ªèµ„æºè€Œä¸ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚å®ƒä¿è¯ä¸¤ä¸ªçº¿ç¨‹æœ€ç»ˆéƒ½èƒ½å®Œæˆæ›´æ–°ï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ä»»ä½•CPUç‰¹å®šçš„æŒ‡ä»¤ã€‚å”¯ä¸€ç”¨åˆ°çš„æ˜¯å…±äº«å†…å­˜ã€‚

### 6.4.1 æ¨¡å‹æè¿°

åœ¨æœ¬ä¾‹ä¸­ï¼ŒåŸå­æ€§çš„ç²’åº¦æ˜¯å•æ¡çš„CPUæŒ‡ä»¤ï¼Œé€šè¿‡ç»™æ¯ä¸€è¡Œä»£ç ä¸€ä¸ªæ ‡ç­¾æ¥æ¨¡æ‹Ÿã€‚


![](media/15608177923231/15609583313866.jpg)

> â—ï¸è¿™ä¸ªä¾‹å­ä»…é€‚ç”¨äºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸‰ä¸ªæˆ–æ›´å¤šçš„çº¿ç¨‹ä¼šé”æ­»çš„ï¼

> `flag`æ˜¯ç”¨æ¥åå•†ä¸¤ä¸ªçº¿ç¨‹çš„å…±äº«å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªåˆ†é‡ï¼Œåˆå§‹åŒ–ä¸ºFalse
> æ¯ä¸ªè¿›ç¨‹å…ˆæŠŠè‡ªå·±ç½®ä¸ºTrueï¼Œç„¶åç­‰å¾…å…¶ä»–çº¿ç¨‹çš„`flag`çš„åˆ†é‡ä¸ºFalse
> å½“å®Œæˆå¯¹å…±äº«èµ„æºçš„è®¿é—®åï¼ŒæŠŠflagçš„å¯¹åº”åˆ†é‡ç½®ä¸ºFalseã€‚

### 6.4.2 ä¸å˜é‡çš„å®šä¹‰
æè¿°ä¸ºï¼šåœ¨ä»»ä¸€æ—¶åˆ»ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºä¸­
æ˜¯å¦åœ¨ä¸´ç•ŒåŒºå¯ä»¥é€šè¿‡æ£€æŸ¥`pc`çš„å€¼æ˜¯å¦ä¸º`ï¼‚CSï¼‚`æ¥å®ç°ã€‚
ç»™å‡ºä¸¤ç§è¡¨è¿°æ–¹å¼ï¼š

#### 6.4.2.1 ç¬¬ä¸€ç§è¡¨è¿°


![](media/15608177923231/15609601504285.jpg)
> ä¸¤ç§æƒ…å†µï¼š
> 1. æ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¸åœ¨CSï¼Œæˆ–
> 2. æœ‰ä¸”åªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨CSä¸­
> æ³¨æ„TLAçš„æè¿°æ–¹å¼ï¼š
> > å­˜åœ¨ä¸€ä¸ªtï¼Œæ»¡è¶³tåœ¨CSä¸­ï¼Œä¸”å¯¹æ‰€æœ‰å…¶ä»–çš„è¿›ç¨‹t2ï¼Œt2ä¸åœ¨CSä¸­

> ä½œè€…è®¤ä¸ºè¿™ä¸ªå†™æ³•å¤ª`nave`ï¼Œæˆ‘å€’è§‰å¾—æŒºå¥½æ‡‚çš„ã€‚åå€’æ˜¯ä¸‹ä¸€ä¸ªå†™æ³•å¾ˆè´¹è§£


#### 6.4.2.2 å†™æ³•2
å¯¹å†™æ³•1ï¼Œä½œè€…è®¤ä¸ºï¼šä¸ºä»€ä¹ˆè¦æŠŠï¼‚æœ€å¤šä¸€ä¸ªçº¿ç¨‹ï¼‚æŠ˜æˆï¼‚æ²¡æœ‰ä¸€ä¸ªæˆ–åªæœ‰ä¸€ä¸ªï¼‚ï¼Ÿå³ä¸‹é¢çš„å†™æ³•ï¼š

![](media/15608177923231/15610083803840.jpg)

> å®ƒçš„å«ä¹‰æ˜¯ï¼š
> > å¯¹`Threads`ä¸­çš„ä»»æ„ä¸¤ä¸ªçº¿ç¨‹ç»„åˆï¼Œå®ƒä»¬ä¸ç›¸åŒï¼Œåˆ™ä¸å®ƒä»¬ä¸å¯èƒ½éƒ½åœ¨CSä¸­ã€‚

æ‰§è¡Œï¼šThreads <- 1..2, INVARIANT AtMostOneCritical, Deadlock.

ä¼šæ­»é”ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæŠŠè‡ªå·±çš„flagè®¾ä¸ºTrueï¼Œç„¶åç­‰å¯¹æ–¹å˜æˆFalseã€‚

### 6.4.3 ä¸æˆåŠŸçš„ä¿®æ”¹å°è¯•

è®©æ¯ä¸ªçº¿ç¨‹åœ¨é‡åˆ°å†²çªæ—¶ä¸æ–­å°†è‡ªå·±çš„flagè®¾ä¸ºFalseå†æ”¹å›Trueã€‚
> ä¹Ÿå³ï¼ŒæŒ‡æœ›è‡ªå·±é‡Šæ”¾çš„æ—¶å€™èƒ½è®©åˆ«äººå¾—åˆ°æœºä¼šã€‚

![](media/15608177923231/15610338773594.jpg)

æ‰§è¡Œçš„ç»“æœæ»¡è¶³è§„æ ¼ï¼šæœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œä¸”æ²¡æœ‰æ­»é”ã€‚

ä½†è¿˜åº”æ£€æŸ¥çº¿ç¨‹æ˜¯å¦èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚å¢åŠ ä¸€ä¸ªæ£€æŸ¥é¡¹ï¼š

```
Liveness ==   
    \A t \in Threads:     <>(pc[t] = â€CSâ€œ)
```
> æ¯ä¸ªçº¿ç¨‹æœ€ç»ˆéƒ½èƒ½è¿›å…¥ä¸´ç•ŒåŒº
> å¯¹ç…§`<>`çš„å®šä¹‰ï¼šï¼‚ç»ˆå½’ä¼šæœ‰â€¦â€¦ï¼‚

### 6.4.4 å†æ¬¡ä¿®æ”¹
ç®—æ³•ä¿®æ”¹ï¼šå¢åŠ äº†ä¸€ä¸ªè¡¨ç¤ºä¸‹ä¸€ä¸ªå°†è¢«æ‰§è¡Œçš„çº¿ç¨‹æ ‡è¯†`next_thread`ï¼Œå½“å†²çªæ—¶ï¼Œçº¿ç¨‹å…ˆé‡Šæ”¾è‡ªå·±ï¼Œç„¶åç­‰å¾…è½®åˆ°è‡ªå·±æ‰§è¡Œã€‚æ‰§è¡Œåå†å°†æ‰§è¡Œæƒäº¤ç»™å¦ä¸€ä¸ªçº¿ç¨‹ã€‚

![](media/15608177923231/15610365957567.jpg)

> å®é™…ä¸ŠDekkeråªé€‚ç”¨ä¸¤ä¸ªçº¿ç¨‹ã€‚å½“çº¿ç¨‹æ•°è¶…è¿‡ä¸¤ä¸ªæ—¶å°±ä¼šå¤±è´¥ã€‚
> å¦å¤–çš„é—®é¢˜æ˜¯ç¼ºä¹éŸ§æ€§ï¼šè‹¥ä¸€ä¸ªçº¿ç¨‹å´©æºƒäº†ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ— æ³•å®Œæˆã€‚


### 6.4.5 æ¨¡æ‹Ÿçº¿ç¨‹å´©æºƒ



```
EXTENDS TLC, Integers, Sequences 
\* CONSTANT Threads 

Threads == 1..2 
(*--algorithm dekker 
variables   
    flag = [t \in Threads |-> FALSE],   
    next_thread \in Threads; 

â—ï¸ æŠŠè¡Œä¸ºæŠ½å–æˆprocedure,ä¾›åé¢çš„ä¸¤ä¸ªè¿‡ç¨‹å…±ç”¨
â—ï¸è¡Œä¸ºå’Œä¸Šä¸€èŠ‚çš„ä¾‹å­æ˜¯ä¸€æ ·çš„
procedure thread() 
begin   
    P1: flag[self] := TRUE;   
    P2:     
        while \E t \in Threads \ {self}: flag[t] do       
            P2_1:
                if next_thread /= self then           
                    P2_1_1: flag[self] := FALSE;           
                    P2_1_2: await next_thread = self;           
                    P2_1_3: flag[self] := TRUE; 
               end if;     
          end while;   
     CS: skip;   
     P3: next_thread := 3 - next_thread;
     P4: flag[self] := FALSE;   
     P5: goto P1; 
end procedure; 

â—ï¸è¿™ä¸ªè¿‡ç¨‹å®šä¹‰æˆfairçš„ã€‚
\* self is only defined for sets 
fair process fair_thread \in {1} 
begin   
    Fair:     
        call thread(); 
end process; 

â—ï¸è¿™ä¸ªè¿›ç¨‹æ¨¡æ‹Ÿä¼šå´©æºƒï¼šåªè¦ä¸æ˜¯fairå°±å¯ä»¥äº†
process crashable_thread \in {2} 
begin   
    Crashable:     
        call thread(); 
end process; 

end algorithm; *)
```
ğŸ”” å› ä¸º`self`åªèƒ½ç”¨äºé›†åˆï¼Œæ‰€ä»¥ä½¿ç”¨è¯¸å¦‚`\in {1} `è¿™æ ·çš„å†™æ³•ã€‚

è¦æ£€æŸ¥éŸ§æ€§ï¼Œæˆ‘ä»¬è¦æ£€æŸ¥å½“çº¿ç¨‹2å´©æºƒåçº¿ç¨‹1æ˜¯å¦è¿˜èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼š

```
veness ==   
        \A t \in {1}:     <>(pc[t] = â€CSâ€œ)
```
è§„çº¦æ‰§è¡Œå¤±è´¥ï¼šçº¿ç¨‹1ä¼šé˜»å¡åœ¨`P2_1_1`å¤„ã€‚

## 6.5
è¿™ä¸€ç« çš„ä¾‹å­æ˜¯æ¯”è¾ƒéš¾ç†è§£çš„ã€‚


